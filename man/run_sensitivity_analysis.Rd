% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_sensitivity_analysis.R
\name{run_sensitivity_analysis}
\alias{run_sensitivity_analysis}
\title{Perform Sensitivity Analysis for Differential Abundance}
\usage{
run_sensitivity_analysis(
  expomicset,
  base_formula,
  abundance_col = "counts",
  methods = c("limma_voom", "DESeq2", "edgeR_quasi_likelihood"),
  scaling_methods = c("none", "TMM", "quantile"),
  min_counts_range = c(1, 5, 10),
  min_proportion_range = c(0.1, 0.2, 0.3),
  contrasts = NULL,
  covariates_to_remove = NULL,
  score_thresh = NULL,
  score_quantile = 0.1,
  action = "add"
)
}
\arguments{
\item{expomicset}{A \code{MultiAssayExperiment} object containing omics and exposure data.}

\item{base_formula}{A formula specifying the base model for differential abundance analysis.}

\item{abundance_col}{A character string specifying the assay column to use for abundance values. Default is \code{"counts"}.}

\item{methods}{A character vector of methods for differential abundance testing (e.g., \code{"limma_voom"}, \code{"DESeq2"}, \code{"edgeR_quasi_likelihood"}).}

\item{scaling_methods}{A character vector of normalization methods to apply (e.g., \code{"none"}, \code{"TMM"}, \code{"quantile"}).}

\item{min_counts_range}{A numeric vector of minimum count thresholds to test. Default is \code{c(1, 5, 10)}.}

\item{min_proportion_range}{A numeric vector of minimum sample proportion thresholds to test. Default is \code{c(0.1, 0.2, 0.3)}.}

\item{contrasts}{A character vector specifying contrasts for the differential analysis. Default is \code{NULL}.}

\item{covariates_to_remove}{A character vector of covariates to iteratively remove from the model for sensitivity testing. Default is \code{NULL}.}

\item{score_thresh}{A numeric value specifying a fixed threshold for feature stability. If \code{NULL}, it is determined based on \code{score_quantile}.}

\item{score_quantile}{A numeric value specifying the quantile threshold for determining stable features. Default is \code{0.1}.}

\item{action}{A character string specifying whether to store (\code{"add"}) or return (\code{"get"}) the results. Default is \code{"add"}.}
}
\value{
A \code{MultiAssayExperiment} object with sensitivity analysis results added to metadata (if \code{action = "add"}) or a list with:
\item{sensitivity_df}{A dataframe of differential abundance results across all tested conditions.}
\item{feature_stability}{A dataframe summarizing stability scores for each feature.}
\item{score_thresh}{The threshold used for stable feature selection.}
}
\description{
Runs differential abundance testing across multiple models, statistical methods,
scaling approaches, and filtering criteria to assess feature stability.
}
\details{
This function:
\itemize{
\item Iterates over multiple \strong{model specifications} by removing covariates.
\item Tests different \strong{differential abundance methods} (\code{limma_voom}, \code{DESeq2}, \code{edgeR_quasi_likelihood}).
\item Evaluates \strong{scaling approaches} (\code{none}, \code{TMM}, \code{quantile}).
\item Filters features based on \strong{minimum count} and \strong{sample proportion} thresholds.
\item \strong{Calculates feature stability}, measuring how often a feature is identified across conditions.
\item Determines a \strong{stability threshold} using either \code{score_thresh} or the \code{score_quantile}.
\item \strong{Output Handling}:
\itemize{
\item \code{"add"}: Stores results in \code{metadata(expomicset)$sensitivity_analysis}.
\item \code{"get"}: Returns a list containing the sensitivity results.
}
}
}
\examples{
\dontrun{
expom <- run_sensitivity_analysis(
  expomicset = expom,
  base_formula = ~ condition + batch,
  methods = c("limma_voom", "DESeq2"),
  min_counts_range = c(5, 10),
  action = "add"
)

sensitivity_results <- run_sensitivity_analysis(
  expomicset = expom,
  base_formula = ~ condition + batch,
  action = "get"
)
}

}
